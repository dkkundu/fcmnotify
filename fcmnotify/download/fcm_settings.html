<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script> <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script><script>var firebaseConfig = { apiKey: "AIzaSyDJ7wQBYCvqVYV1aSTd-pCWf2A02K9Fev4",authDomain:"dphe-pedp4.firebaseapp.com",databaseURL: "https://f80.asia-southeast1.firebasedatabase.app",projectId:"dphe-pedp4" ,storageBucket:"dphe-pedp4.appspot.com",messagingSenderId:"13439039873",appId:"1:13439039873:web:ca9cb722f1d5bc300c5080",measurementId:"13439039873",usePublicVapidKey:"BEBxGw-mEu95kMyEDIPrCm9rHxur0JoKpWh2JkycogtgA6Qh7COg56G5sfUyEpbaX841R_TV2XnaYBRsNaswqSg" };firebase.initializeApp(firebaseConfig);const messaging=firebase.messaging();function IntitalizeFireBaseMessaging() {messaging.requestPermission().then(function () {console.log("Notification Permission");return messaging.getToken();}).then(function (token) {console.log("Token : "+token);sendToServer(token);}).catch(function (reason) {console.log(reason);});}messaging.onMessage(function (payload) {console.log(payload);const notificationOption={body:payload.notification.body,icon:payload.notification.icon};if(Notification.permission==="granted"){var notification=new Notification(payload.notification.title,notificationOption);notification.onclick=function (ev) {ev.preventDefault(); window.open(payload.notification.click_action,"_blank"); notification.close();}}});messaging.onTokenRefresh(function () {messaging.getToken().then(function (newtoken) {console.log("New Token : "+ newtoken);sendToServer(newtoken);}).catch(function (reason) {console.log(reason);}) });function sendToServer(token){$.ajax({url:"/save_fcm_token/",type:"POST",data:{token:token},}).done(function(response){if(response=="TOKEN SAVED"){console.log("Save")}else{ console.log("Error in Token Save")}});}IntitalizeFireBaseMessaging();</script>